<!DOCTYPE html>





<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Slippers_32x32.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Slippers_16x16.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css">
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    save_scroll: false,
    copycode: {"enable":true,"show_result":true,"style":null},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>
<script>
    (function () {
        if ('') {
            if (prompt('请输入文章密码') !== '') {
                alert('密码错误！');
                if (history.length === 1) {
                    location.replace("http://xxxxxxx.xxx"); // 这里替换成你的首页地址
                } else {
                    history.back();
                }
            }
        }
    })();
</script>

  <meta name="description" content="1. Docker简介Docker是一种虚拟化技术，类比于虚拟机。虚拟机需要模拟硬件还有很多不常用的软件等，而Docker是共用宿主机的内核，需要什么软件就引入相应的容器，而且各个容器之间是隔离的，互不影响也能通信。Dockre是比虚拟机更加轻量的虚拟技术。 1.1 基本概念 镜像image  Docker镜像就好比是一个模板，可以通过这个模板来创建容器服务(可以创建多个容器)。 比如，tomca">
<meta name="keywords" content="Java,SSM,大学生活">
<meta property="og:type" content="article">
<meta property="og:title" content="JinMing">
<meta property="og:url" content="http://caixukun8.top/2021/01/01/Spring Cloud/Docker/index.html">
<meta property="og:site_name" content="JinMing">
<meta property="og:description" content="1. Docker简介Docker是一种虚拟化技术，类比于虚拟机。虚拟机需要模拟硬件还有很多不常用的软件等，而Docker是共用宿主机的内核，需要什么软件就引入相应的容器，而且各个容器之间是隔离的，互不影响也能通信。Dockre是比虚拟机更加轻量的虚拟技术。 1.1 基本概念 镜像image  Docker镜像就好比是一个模板，可以通过这个模板来创建容器服务(可以创建多个容器)。 比如，tomca">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101205537190.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101213032540.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101214614552.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101213937951.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101225333094.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101225852498.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102132444427.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102132515791.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/12842279-f5d4c22882f4a649.png?imageMogr2/auto-orient/strip%7CimageView2/2/format/webp">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102143249340.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102154829545.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102193605035.png">
<meta property="og:updated_time" content="2021-01-03T14:50:55.524Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JinMing">
<meta name="twitter:description" content="1. Docker简介Docker是一种虚拟化技术，类比于虚拟机。虚拟机需要模拟硬件还有很多不常用的软件等，而Docker是共用宿主机的内核，需要什么软件就引入相应的容器，而且各个容器之间是隔离的，互不影响也能通信。Dockre是比虚拟机更加轻量的虚拟技术。 1.1 基本概念 镜像image  Docker镜像就好比是一个模板，可以通过这个模板来创建容器服务(可以创建多个容器)。 比如，tomca">
<meta name="twitter:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101205537190.png">
  <link rel="canonical" href="http://caixukun8.top/2021/01/01/Spring Cloud/Docker/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title> | JinMing</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <div class="container sidebar-position-left">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JinMing</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">风在前，无惧!</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">41</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">11</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">76</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>


    </div>
</nav>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content page-post-detail">
            

  <div id="posts" class="posts-expand">
    
    <div class="reading-progress-bar"></div>

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://caixukun8.top/2021/01/01/Spring Cloud/Docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JinMing">
      <meta itemprop="description" content="且行且珍惜">
      <meta itemprop="image" content="/images/1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JinMing">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">

            
          </h1>
        

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2021-01-01 19:47:15" itemprop="dateCreated datePublished" datetime="2021-01-01T19:47:15+08:00">2021-01-01</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-01-03 22:50:55" itemprop="dateModified" datetime="2021-01-03T22:50:55+08:00">2021-01-03</time>
              </span>
            
          

          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>33k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>30 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="1-Docker简介"><a href="#1-Docker简介" class="headerlink" title="1. Docker简介"></a>1. Docker简介</h3><p>Docker是一种虚拟化技术，类比于虚拟机。虚拟机需要模拟硬件还有很多不常用的软件等，而Docker是共用宿主机的内核，需要什么软件就引入相应的容器，而且各个容器之间是隔离的，互不影响也能通信。<code>Dockre是比虚拟机更加轻量的虚拟技术。</code></p>
<h4 id="1-1-基本概念"><a href="#1-1-基本概念" class="headerlink" title="1.1 基本概念"></a>1.1 基本概念</h4><blockquote>
<p>镜像image</p>
</blockquote>
<p>Docker镜像就好比是一个模板，可以通过这个模板来创建容器服务(可以创建多个容器)。</p>
<p>比如，tomcat镜像 -&gt; run -&gt; tomcat容器（提供服务）。</p>
<blockquote>
<p>容器Container</p>
</blockquote>
<p>Docker利用容器技术，独立运行一个或一组应用。</p>
<p>容器是通过镜像来创建的。</p>
<blockquote>
<p>仓库Repository</p>
</blockquote>
<p>仓库就是存放镜像的地方。分为公有仓库和私有仓库。</p>
<p>DockerHub(国外)，阿里云(国内，配置镜像加速)</p>
<h4 id="1-2-安装Docker"><a href="#1-2-安装Docker" class="headerlink" title="1.2 安装Docker"></a>1.2 安装Docker</h4><ol>
<li>查看环境</li>
</ol>
<p>查看Linux版本，系统内核要求3.10以上：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux ming 3.10.0-514.26.2.el7.x86_64 #1 SMP Tue Jul 4 15:04:05 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure>

<p>查看系统信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/os-release</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">NAME="CentOS Linux"</span><br><span class="line">VERSION="7 (Core)"</span><br><span class="line">ID="centos"</span><br><span class="line">ID_LIKE="rhel fedora"</span><br><span class="line">VERSION_ID="7"</span><br><span class="line">PRETTY_NAME="CentOS Linux 7 (Core)"</span><br><span class="line">ANSI_COLOR="0;31"</span><br><span class="line">CPE_NAME="cpe:/o:centos:centos:7"</span><br><span class="line">HOME_URL="https://www.centos.org/"</span><br><span class="line">BUG_REPORT_URL="https://bugs.centos.org/"</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT="CentOS-7"</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION="7"</span><br><span class="line">REDHAT_SUPPORT_PRODUCT="centos"</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION="7"</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>安装Docker</li>
</ol>
<blockquote>
<p>如果已经安装过docker，卸载已经安装的版本</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<blockquote>
<p>设置Docker的仓库</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 下载yum-utils(其中包含了yum-config-manager)</span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line"><span class="meta">#</span> 2. 设置阿里的docker仓库地址</span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<blockquote>
<p>安装Docker</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 清除缓存</span><br><span class="line">yum makecache fast</span><br><span class="line"><span class="meta">#</span> 下载docker</span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查看Docker版本信息</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>

<p>出现以下结果，说明Docker安装成功。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           20.10.1</span><br><span class="line"> API version:       1.41</span><br><span class="line"> Go version:        go1.13.15</span><br><span class="line"> Git commit:        831ebea</span><br><span class="line"> Built:             Tue Dec 15 04:37:17 2020</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      true</span><br></pre></td></tr></table></figure>

<blockquote>
<p>启动docker</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure>

<blockquote>
<p>运行hello-world示例镜像</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101205537190.png" alt="image-docker hello-world"></p>
<h4 id="1-3-阿里云镜像加速器"><a href="#1-3-阿里云镜像加速器" class="headerlink" title="1.3 阿里云镜像加速器"></a>1.3 阿里云镜像加速器</h4><p>登录阿里云，找到<code>容器镜像服务</code>，镜像加速器。</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101213032540.png" alt="image-阿里云镜像加速器"></p>
<h4 id="1-4-docerk-run-流程"><a href="#1-4-docerk-run-流程" class="headerlink" title="1.4 docerk run 流程"></a>1.4 docerk run 流程</h4><p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101214614552.png" alt="image-docker run运行流程"></p>
<h4 id="1-5-底层原理"><a href="#1-5-底层原理" class="headerlink" title="1.5 底层原理"></a>1.5 底层原理</h4><blockquote>
<p>Docker是怎么工作的？</p>
</blockquote>
<p>Docker是一个Client-Server结构的系统，Docker的守护进程运行在服务器上，客户端通过Socket访问，</p>
<p>Docker Server接收到Docker Client的指令，就会执行这个命令。</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101213937951.png" alt="image-Docker工作原理"></p>
<h3 id="2-镜像的基本命令"><a href="#2-镜像的基本命令" class="headerlink" title="2.镜像的基本命令"></a>2.镜像的基本命令</h3><p><a href="https://docs.docker.com/engine/reference/commandline/docker/" target="_blank" rel="noopener">官方参考文档</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 显示docker版本</span><br><span class="line">docker version</span><br><span class="line"><span class="meta">#</span> 显示docker的系统信息，包括镜像和容器的数量</span><br><span class="line">docker info</span><br><span class="line"><span class="meta">#</span> 帮助命令</span><br><span class="line">docker 命令 --help</span><br></pre></td></tr></table></figure>

<h4 id="2-1-查看镜像"><a href="#2-1-查看镜像" class="headerlink" title="2.1 查看镜像"></a>2.1 查看镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 查看所有镜像</span><br><span class="line">docker images -a</span><br><span class="line"><span class="meta">#</span> 2. 查看镜像的id</span><br><span class="line">docker images -q</span><br></pre></td></tr></table></figure>

<h4 id="2-2-搜索镜像"><a href="#2-2-搜索镜像" class="headerlink" title="2.2 搜索镜像"></a>2.2 搜索镜像</h4><p>搜索镜像可以使用DockerHub搜索，也可以使用命令进行搜索。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 搜索mysql的镜像</span><br><span class="line">docker search mysql</span><br><span class="line"><span class="meta">#</span> 2. 搜索stars大于9000的本版</span><br><span class="line">docker search mysql --filter=stars=9000</span><br></pre></td></tr></table></figure>

<h4 id="2-3-下载镜像"><a href="#2-3-下载镜像" class="headerlink" title="2.3 下载镜像"></a>2.3 下载镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 不指定版本，默认下载最新版本latest</span><br><span class="line">docker pull mysql</span><br><span class="line"><span class="meta">#</span> 2. 下载指定版本，这里的版本号一定要是DockerHub上有的版本</span><br><span class="line">docker pull mysql:5.7</span><br></pre></td></tr></table></figure>

<p>既然知道了真实地址，docker pull mysql:5.7 相当于 docker pull docker.io/library/mysql:5.7</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101225333094.png" alt="image-docker pull mysql:5.7"></p>
<h4 id="2-4-删除镜像"><a href="#2-4-删除镜像" class="headerlink" title="2.4 删除镜像"></a>2.4 删除镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1.通过镜像名称删除，-f 强制删除</span><br><span class="line">docker rmi -f mysql</span><br><span class="line"><span class="meta">#</span> 2. 通过id删除</span><br><span class="line">docker rmi -f f07dfa83b528</span><br><span class="line"><span class="meta">#</span> 3. 删除所有的镜像</span><br><span class="line">docker rmi -f $(docker images -aq)</span><br></pre></td></tr></table></figure>

<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101225852498.png" alt="image-删除镜像"></p>
<h3 id="3-容器的基本命令"><a href="#3-容器的基本命令" class="headerlink" title="3.容器的基本命令"></a>3.容器的基本命令</h3><h4 id="3-1-创建容器并启动"><a href="#3-1-创建容器并启动" class="headerlink" title="3.1 创建容器并启动"></a>3.1 创建容器并启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 以交互模式启动centos容器，交互使用bash命令行</span><br><span class="line">docker run -it centos /bin/bash</span><br><span class="line"><span class="meta">#</span> 也可以使用images id 启动容器</span><br><span class="line">docker run -it 300e315adb2f /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 参数解释</span><br><span class="line">--name=""  # 指定容器名字</span><br><span class="line">-d         # 后台方式运行</span><br><span class="line">-it        # 使用交互方式运行，进入容器查看内容</span><br><span class="line">-p         # 指定容器的端口，有以下几种形式</span><br><span class="line">	- 主机端口：容器端口（常用）</span><br><span class="line">	- ip:主机端口：容器端口</span><br><span class="line">	- 容器端口</span><br><span class="line">-P         # 随机指定端口</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 进入容器后,主机名称变成了容器id</span><br><span class="line">[root@8434890d1132 /]# </span><br><span class="line"></span><br><span class="line">[root@ming local]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">41a27a712b32   centos    "/bin/bash"   14 seconds ago   Up 13 seconds             funny_wright</span><br></pre></td></tr></table></figure>

<h4 id="3-2-查看容器"><a href="#3-2-查看容器" class="headerlink" title="3.2 查看容器"></a>3.2 查看容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 查看正在运行的容器</span><br><span class="line">docker ps </span><br><span class="line"><span class="meta">#</span> 2. 查看正在运行的容器和历史运行的容器</span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 参数解释</span><br><span class="line">-n=1 # 显示最近创建的容器</span><br><span class="line">-q   # 只显示容器id</span><br></pre></td></tr></table></figure>

<h4 id="3-3-退出容器"><a href="#3-3-退出容器" class="headerlink" title="3.3 退出容器"></a>3.3 退出容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 退出容器并关闭</span><br><span class="line">[root@8434890d1132 /]# exit</span><br><span class="line"><span class="meta">#</span> 2. 退出容器，不关闭</span><br><span class="line">CTRL + P + Q</span><br></pre></td></tr></table></figure>

<h4 id="3-4-删除容器"><a href="#3-4-删除容器" class="headerlink" title="3.4 删除容器"></a>3.4 删除容器</h4><p>删除容器使用rm，删除镜像使用rmi。(i = image)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 指定容器id删除</span><br><span class="line">docker rm -f 41a27a712b32</span><br><span class="line"><span class="meta">#</span> 2. 删除所有容器，指定参数-f强制删除，如果容器正在运行，也能删除</span><br><span class="line">docker rm -f $(docker ps -aq)</span><br><span class="line"><span class="meta">#</span> 3. 删除所有容器，如果容器正在运行，会报错</span><br><span class="line">docker ps -aq|xargs docker rm</span><br></pre></td></tr></table></figure>

<h4 id="3-5-启动和停止容器"><a href="#3-5-启动和停止容器" class="headerlink" title="3.5 启动和停止容器"></a>3.5 启动和停止容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 启动容器</span><br><span class="line">docker start 容器id</span><br><span class="line"><span class="meta">#</span> 2. 重启容器</span><br><span class="line">docker restart 容器id</span><br><span class="line"><span class="meta">#</span> 3. 停止容器</span><br><span class="line">docker stop 容器id</span><br><span class="line"><span class="meta">#</span> 4. 容器在运行，可以使用kill强制停止容器</span><br><span class="line">docker kill 容器id</span><br></pre></td></tr></table></figure>

<h3 id="4-常用其他命令"><a href="#4-常用其他命令" class="headerlink" title="4.常用其他命令"></a>4.常用其他命令</h3><h4 id="4-1-后台启动容器"><a href="#4-1-后台启动容器" class="headerlink" title="4.1 后台启动容器"></a>4.1 后台启动容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d 镜像名称</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 问题：后台方式启动容器后,docker ps查看容器,发现刚启动的容器停止了?</span><br><span class="line">docker容器使用后台运行，就必须要有一个前台进程，docker发现没有应用，就会自动停止.</span><br></pre></td></tr></table></figure>

<h4 id="4-2-查看日志"><a href="#4-2-查看日志" class="headerlink" title="4.2 查看日志"></a>4.2 查看日志</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 查看容器7194f420dccf最近10行的日志信息</span><br><span class="line">docker logs -tf --tail 10 7194f420dccf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 参数解释</span><br><span class="line">-f # 显示最新的日志</span><br><span class="line">-t # 显示时间戳</span><br><span class="line">-tail n # 显示最后n行</span><br></pre></td></tr></table></figure>

<p>为了方便查看日志，启动容器的时候让它运行脚本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 后台方式启动，每隔1s输出hello,world，方便查看日志信息</span><br><span class="line">docker run -d centos /bin/sh -c "while true;do echo hello,world;sleep 1;done"</span><br><span class="line"></span><br><span class="line">[root@ming local]# docker logs -tf --tail 10 7194f420dccf </span><br><span class="line">2021-01-02T04:59:49.064172640Z hello,world</span><br><span class="line">2021-01-02T04:59:50.065917036Z hello,world</span><br><span class="line">2021-01-02T04:59:51.067497230Z hello,world</span><br><span class="line">2021-01-02T04:59:52.069279085Z hello,world</span><br><span class="line">2021-01-02T04:59:53.070906928Z hello,world</span><br><span class="line">2021-01-02T04:59:54.072698176Z hello,world</span><br><span class="line">2021-01-02T04:59:55.074312881Z hello,world</span><br><span class="line">2021-01-02T04:59:56.075940314Z hello,world</span><br><span class="line">2021-01-02T04:59:57.077579824Z hello,world</span><br><span class="line">2021-01-02T04:59:58.083724580Z hello,world</span><br><span class="line">2021-01-02T04:59:59.085284061Z hello,world</span><br><span class="line">2021-01-02T05:00:00.086883423Z hello,world</span><br><span class="line">2021-01-02T05:00:01.088530900Z hello,world</span><br></pre></td></tr></table></figure>

<h4 id="4-3-查看容器中进程的信息"><a href="#4-3-查看容器中进程的信息" class="headerlink" title="4.3 查看容器中进程的信息"></a>4.3 查看容器中进程的信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 查看容器中进程信息</span><br><span class="line">docker top 7194f420dccf</span><br></pre></td></tr></table></figure>

<h4 id="4-4-查看镜像的元数据"><a href="#4-4-查看镜像的元数据" class="headerlink" title="4.4 查看镜像的元数据"></a>4.4 查看镜像的元数据</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器id</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;	</span><br><span class="line">        # 容器的完整id，默认只是截取前面几位</span><br><span class="line">        "Id": "7194f420dccf83fc219103ba4b8fe704583cbe52a8e0ad53bc5ee7c788ece631",</span><br><span class="line">        "Created": "2021-01-02T04:54:22.996950933Z", # 容器创建时间</span><br><span class="line">        "Path": "/bin/sh",</span><br><span class="line">        "Args": [ # 启动容器时使用的参数</span><br><span class="line">            "-c",</span><br><span class="line">            <span class="string">"while true;do echo hello,world;sleep 1;done"</span></span><br><span class="line">        ],</span><br><span class="line">        "State": &#123; # 容器状态</span><br><span class="line">            "Status": "running",</span><br><span class="line">            "Running": true,</span><br><span class="line">            "Paused": false,</span><br><span class="line">            "Restarting": false,</span><br><span class="line">            "OOMKilled": false,</span><br><span class="line">            "Dead": false,</span><br><span class="line">            "Pid": 19341,</span><br><span class="line">            "ExitCode": 0,</span><br><span class="line">            "Error": "",</span><br><span class="line">            "StartedAt": "2021-01-02T04:54:23.420056968Z",</span><br><span class="line">            "FinishedAt": "0001-01-01T00:00:00Z"</span><br><span class="line">        &#125;,</span><br><span class="line">        "Image": "sha256:300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55", # 镜像信息</span><br><span class="line">        "ResolvConfPath": "/var/lib/docker/containers/7194f420dccf83fc219103ba4b8fe704583cbe52a8e0ad53bc5ee7c788ece631/resolv.conf",</span><br><span class="line">        "HostnamePath": "/var/lib/docker/containers/7194f420dccf83fc219103ba4b8fe704583cbe52a8e0ad53bc5ee7c788ece631/hostname",</span><br><span class="line">        "HostsPath": "/var/lib/docker/containers/7194f420dccf83fc219103ba4b8fe704583cbe52a8e0ad53bc5ee7c788ece631/hosts",</span><br><span class="line">        "LogPath": "/var/lib/docker/containers/7194f420dccf83fc219103ba4b8fe704583cbe52a8e0ad53bc5ee7c788ece631/7194f420dccf83fc219103ba4b8fe704583cbe52a8e0ad53bc5ee7c788ece631-json.log",</span><br><span class="line">        "Name": "/quizzical_brown",</span><br><span class="line">        "RestartCount": 0,</span><br><span class="line">        "Driver": "overlay2",</span><br><span class="line">        "Platform": "linux",</span><br><span class="line">        "MountLabel": "",</span><br><span class="line">        "ProcessLabel": "",</span><br><span class="line">        "AppArmorProfile": "",</span><br><span class="line">        "ExecIDs": null,</span><br><span class="line">        "HostConfig": &#123;</span><br><span class="line">            "Binds": null,</span><br><span class="line">            "ContainerIDFile": "",</span><br><span class="line">            "LogConfig": &#123;</span><br><span class="line">                "Type": "json-file",</span><br><span class="line">                "Config": &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            "NetworkMode": "default",</span><br><span class="line">            "PortBindings": &#123;&#125;,</span><br><span class="line">            "RestartPolicy": &#123;</span><br><span class="line">                "Name": "no",</span><br><span class="line">                "MaximumRetryCount": 0</span><br><span class="line">            &#125;,</span><br><span class="line">            "AutoRemove": false,</span><br><span class="line">            "VolumeDriver": "",</span><br><span class="line">            "VolumesFrom": null,</span><br><span class="line">            "CapAdd": null,</span><br><span class="line">            "CapDrop": null,</span><br><span class="line">            "CgroupnsMode": "host",</span><br><span class="line">            "Dns": [],</span><br><span class="line">            "DnsOptions": [],</span><br><span class="line">            "DnsSearch": [],</span><br><span class="line">            "ExtraHosts": null,</span><br><span class="line">            "GroupAdd": null,</span><br><span class="line">            "IpcMode": "private",</span><br><span class="line">            "Cgroup": "",</span><br><span class="line">            "Links": null,</span><br><span class="line">            "OomScoreAdj": 0,</span><br><span class="line">            "PidMode": "",</span><br><span class="line">            "Privileged": false,</span><br><span class="line">            "PublishAllPorts": false,</span><br><span class="line">            "ReadonlyRootfs": false,</span><br><span class="line">            "SecurityOpt": null,</span><br><span class="line">            "UTSMode": "",</span><br><span class="line">            "UsernsMode": "",</span><br><span class="line">            "ShmSize": 67108864,</span><br><span class="line">            "Runtime": "runc",</span><br><span class="line">            "ConsoleSize": [</span><br><span class="line">                0,</span><br><span class="line">                <span class="number">0</span></span><br><span class="line">            ],</span><br><span class="line">            "Isolation": "",</span><br><span class="line">            "CpuShares": 0,</span><br><span class="line">            "Memory": 0,</span><br><span class="line">            "NanoCpus": 0,</span><br><span class="line">            "CgroupParent": "",</span><br><span class="line">            "BlkioWeight": 0,</span><br><span class="line">            "BlkioWeightDevice": [],</span><br><span class="line">            "BlkioDeviceReadBps": null,</span><br><span class="line">            "BlkioDeviceWriteBps": null,</span><br><span class="line">            "BlkioDeviceReadIOps": null,</span><br><span class="line">            "BlkioDeviceWriteIOps": null,</span><br><span class="line">            "CpuPeriod": 0,</span><br><span class="line">            "CpuQuota": 0,</span><br><span class="line">            "CpuRealtimePeriod": 0,</span><br><span class="line">            "CpuRealtimeRuntime": 0,</span><br><span class="line">            "CpusetCpus": "",</span><br><span class="line">            "CpusetMems": "",</span><br><span class="line">            "Devices": [],</span><br><span class="line">            "DeviceCgroupRules": null,</span><br><span class="line">            "DeviceRequests": null,</span><br><span class="line">            "KernelMemory": 0,</span><br><span class="line">            "KernelMemoryTCP": 0,</span><br><span class="line">            "MemoryReservation": 0,</span><br><span class="line">            "MemorySwap": 0,</span><br><span class="line">            "MemorySwappiness": null,</span><br><span class="line">            "OomKillDisable": false,</span><br><span class="line">            "PidsLimit": null,</span><br><span class="line">            "Ulimits": null,</span><br><span class="line">            "CpuCount": 0,</span><br><span class="line">            "CpuPercent": 0,</span><br><span class="line">            "IOMaximumIOps": 0,</span><br><span class="line">            "IOMaximumBandwidth": 0,</span><br><span class="line">            "MaskedPaths": [</span><br><span class="line">                "/proc/asound",</span><br><span class="line">                "/proc/acpi",</span><br><span class="line">                "/proc/kcore",</span><br><span class="line">                "/proc/keys",</span><br><span class="line">                "/proc/latency_stats",</span><br><span class="line">                "/proc/timer_list",</span><br><span class="line">                "/proc/timer_stats",</span><br><span class="line">                "/proc/sched_debug",</span><br><span class="line">                "/proc/scsi",</span><br><span class="line">                <span class="string">"/sys/firmware"</span></span><br><span class="line">            ],</span><br><span class="line">            "ReadonlyPaths": [</span><br><span class="line">                "/proc/bus",</span><br><span class="line">                "/proc/fs",</span><br><span class="line">                "/proc/irq",</span><br><span class="line">                "/proc/sys",</span><br><span class="line">                <span class="string">"/proc/sysrq-trigger"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "GraphDriver": &#123;</span><br><span class="line">            "Data": &#123;</span><br><span class="line">                "LowerDir": "/var/lib/docker/overlay2/d76624dcc42355cece3b8a39ba99dcf0b1714c80f5c28fc7ff80cf778a635932-init/diff:/var/lib/docker/overlay2/d5c1df794c28e4c26a5118b7df6f110d8cd67fd4b2184e3f0509513bde2686ac/diff",</span><br><span class="line">                "MergedDir": "/var/lib/docker/overlay2/d76624dcc42355cece3b8a39ba99dcf0b1714c80f5c28fc7ff80cf778a635932/merged",</span><br><span class="line">                "UpperDir": "/var/lib/docker/overlay2/d76624dcc42355cece3b8a39ba99dcf0b1714c80f5c28fc7ff80cf778a635932/diff",</span><br><span class="line">                "WorkDir": "/var/lib/docker/overlay2/d76624dcc42355cece3b8a39ba99dcf0b1714c80f5c28fc7ff80cf778a635932/work"</span><br><span class="line">            &#125;,</span><br><span class="line">            "Name": "overlay2"</span><br><span class="line">        &#125;,</span><br><span class="line">        "Mounts": [],</span><br><span class="line">        "Config": &#123;</span><br><span class="line">            "Hostname": "7194f420dccf",</span><br><span class="line">            "Domainname": "",</span><br><span class="line">            "User": "",</span><br><span class="line">            "AttachStdin": false,</span><br><span class="line">            "AttachStdout": false,</span><br><span class="line">            "AttachStderr": false,</span><br><span class="line">            "Tty": false,</span><br><span class="line">            "OpenStdin": false,</span><br><span class="line">            "StdinOnce": false,</span><br><span class="line">            "Env": [</span><br><span class="line">                <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">            ],</span><br><span class="line">            "Cmd": [</span><br><span class="line">                "/bin/sh",</span><br><span class="line">                "-c",</span><br><span class="line">                <span class="string">"while true;do echo hello,world;sleep 1;done"</span></span><br><span class="line">            ],</span><br><span class="line">            "Image": "centos",</span><br><span class="line">            "Volumes": null,</span><br><span class="line">            "WorkingDir": "",</span><br><span class="line">            "Entrypoint": null,</span><br><span class="line">            "OnBuild": null,</span><br><span class="line">            "Labels": &#123;</span><br><span class="line">                "org.label-schema.build-date": "20201204",</span><br><span class="line">                "org.label-schema.license": "GPLv2",</span><br><span class="line">                "org.label-schema.name": "CentOS Base Image",</span><br><span class="line">                "org.label-schema.schema-version": "1.0",</span><br><span class="line">                "org.label-schema.vendor": "CentOS"</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "NetworkSettings": &#123;</span><br><span class="line">            "Bridge": "",</span><br><span class="line">            "SandboxID": "ea030739e7cabd90101a0040969de447c6ba176267e502f5a5558b19f2a4d813",</span><br><span class="line">            "HairpinMode": false,</span><br><span class="line">            "LinkLocalIPv6Address": "",</span><br><span class="line">            "LinkLocalIPv6PrefixLen": 0,</span><br><span class="line">            "Ports": &#123;&#125;,</span><br><span class="line">            "SandboxKey": "/var/run/docker/netns/ea030739e7ca",</span><br><span class="line">            "SecondaryIPAddresses": null,</span><br><span class="line">            "SecondaryIPv6Addresses": null,</span><br><span class="line">            "EndpointID": "2cef83333f52c17f883782c62909d4878761bb98238aa45939039609e2d1ccfc",</span><br><span class="line">            "Gateway": "172.17.0.1",</span><br><span class="line">            "GlobalIPv6Address": "",</span><br><span class="line">            "GlobalIPv6PrefixLen": 0,</span><br><span class="line">            "IPAddress": "172.17.0.2",</span><br><span class="line">            "IPPrefixLen": 16,</span><br><span class="line">            "IPv6Gateway": "",</span><br><span class="line">            "MacAddress": "02:42:ac:11:00:02",</span><br><span class="line">            "Networks": &#123;</span><br><span class="line">                "bridge": &#123;</span><br><span class="line">                    "IPAMConfig": null,</span><br><span class="line">                    "Links": null,</span><br><span class="line">                    "Aliases": null,</span><br><span class="line">                    "NetworkID": "1cd4dcbb6871cbcce8292729579d2a62dee582c9b7cd3810298c1d69bc1de4cb",</span><br><span class="line">                    "EndpointID": "2cef83333f52c17f883782c62909d4878761bb98238aa45939039609e2d1ccfc",</span><br><span class="line">                    "Gateway": "172.17.0.1",</span><br><span class="line">                    "IPAddress": "172.17.0.2",</span><br><span class="line">                    "IPPrefixLen": 16,</span><br><span class="line">                    "IPv6Gateway": "",</span><br><span class="line">                    "GlobalIPv6Address": "",</span><br><span class="line">                    "GlobalIPv6PrefixLen": 0,</span><br><span class="line">                    "MacAddress": "02:42:ac:11:00:02",</span><br><span class="line">                    "DriverOpts": null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="4-5-进入当前正在运行的容器"><a href="#4-5-进入当前正在运行的容器" class="headerlink" title="4.5 进入当前正在运行的容器"></a>4.5 进入当前正在运行的容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 进入当前正在运行的容器进行操作，不会启动新的进程</span><br><span class="line">docker attach 4db8b5f683c1</span><br><span class="line"><span class="meta">#</span> 2. 进入当前正在运行的容器进行操作，会重新启动一个进程</span><br><span class="line">docker exec -it 4db8b5f683c1 /bin/bash</span><br></pre></td></tr></table></figure>

<p>虽然是不同的进程进行操作，但容器内的资源还是共享的。</p>
<p>首先使用docker exec -it 4db8b5f683c1 /bin/bash进入容器：</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102132444427.png" alt="image-docker attach"></p>
<p>然后使用docker attach 4db8b5f683c1进入容器:并没有启动一个新的/bin/bash进程。</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102132515791.png" alt="image-docker exec"></p>
<h4 id="4-6-从容器内拷贝文件到主机上"><a href="#4-6-从容器内拷贝文件到主机上" class="headerlink" title="4.6 从容器内拷贝文件到主机上"></a>4.6 从容器内拷贝文件到主机上</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 即使容器当前不在运行，也可以拷贝出文件</span><br><span class="line">docker cp 容器id:容器内路径  当前主机路径</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ming local]# docker cp 4db8b5f683c1:/aaa.txt /home/  # 将容器内/aaa.txt 拷贝到当前主机 /home/ 目录下</span><br><span class="line">[root@ming local]# ls /home</span><br><span class="line">aaa.txt</span><br></pre></td></tr></table></figure>

<h3 id="5-命令小结"><a href="#5-命令小结" class="headerlink" title="5.命令小结"></a>5.命令小结</h3><p><img src="https://upload-images.jianshu.io/upload_images/12842279-f5d4c22882f4a649.png?imageMogr2/auto-orient/strip%7CimageView2/2/format/webp" alt="docker命令图谱"></p>
<h3 id="6-小实战"><a href="#6-小实战" class="headerlink" title="6. 小实战"></a>6. 小实战</h3><h4 id="6-1-部署nginx"><a href="#6-1-部署nginx" class="headerlink" title="6.1 部署nginx"></a>6.1 部署nginx</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 下载nginx</span><br><span class="line">docker pull nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. 查看镜像</span><br><span class="line">[root@ming ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">nginx        latest    ae2feff98a0c   2 weeks ago   133MB</span><br><span class="line">centos       latest    300e315adb2f   3 weeks ago   209MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 3. 启动容器，将主机的3344端口映射到容器内的80端口</span><br><span class="line">[root@ming ~]# docker run -p 3344:80 -it nginx  /bin/bash</span><br><span class="line">root@6b29c7751037:/# </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 4.查看nginx安装目录，版本信息</span><br><span class="line">root@6b29c7751037:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line">root@6b29c7751037:/# cd /usr/sbin</span><br><span class="line">root@6b29c7751037:/usr/sbin# ./nginx -version</span><br><span class="line">nginx version: nginx/1.19.6</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 5.启动nginx</span><br><span class="line">root@6b29c7751037:/usr/sbin# ./nginx</span><br></pre></td></tr></table></figure>

<p>外网访问<a href>http://47.96.224.198:3344/</a>，容器内启动nginx成功。</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102143249340.png" alt="image-docker部署nginx"></p>
<h4 id="6-2-部署tomcat"><a href="#6-2-部署tomcat" class="headerlink" title="6.2 部署tomcat"></a>6.2 部署tomcat</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 查看镜像</span><br><span class="line">[root@ming ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">tomcat       latest    feba8d001e3f   2 weeks ago   649MB</span><br><span class="line">nginx        latest    ae2feff98a0c   2 weeks ago   133MB</span><br><span class="line">centos       latest    300e315adb2f   3 weeks ago   209MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. 启动容器，将主机的3355端口映射到容器内的80端口</span><br><span class="line">[root@ming ~]# docker run -p 3355:8080 -it tomcat /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 3. 启动tomcat</span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat/bin# ./startup.sh </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 4. 查看进程，tomcat已经启动</span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat/bin# ps -ef|grep tomcat</span><br><span class="line">root        15     1  1 07:45 pts/0    00:00:02 /usr/local/openjdk-11/bin/java -Djava.util.logging.config.file=/usr/local/tomcat/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Dorg.apache.catalina.security.SecurityListener.UMASK=0027 -Dignore.endorsed.dirs= -classpath /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar -Dcatalina.base=/usr/local/tomcat -Dcatalina.home=/usr/local/tomcat -Djava.io.tmpdir=/usr/local/tomcat/temp org.apache.catalina.startup.Bootstrap start</span><br><span class="line">root        45     1  0 07:47 pts/0    00:00:00 grep tomcat</span><br></pre></td></tr></table></figure>

<p>外网访问<a href>http://47.96.224.198:3355/</a>,出现以下界面：</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102154829545.png" alt="image-访问tomcat"></p>
<p>这是因为阿里云镜像默认是下载最小的镜像，只下载了必要的组件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@5e2e3cb50a29:/usr/local/tomcat# ls  </span><br><span class="line">BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.dist</span><br><span class="line">CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work</span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat# ls webapps  # webapps目录是空的</span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat# ls webapps.dist/   # webapps.dist目录才是原本的webapps目录</span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat# mv webapps webapps.backup</span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat# mv webapps.dist webapps  # 将webapps.dist目录改成webapps目录</span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat# ls</span><br><span class="line">BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.backup</span><br><span class="line">CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work</span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat# ls webapps</span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br></pre></td></tr></table></figure>

<p>再次访问[<a href>http://47.96.224.198:3355/</a>,这次就可以正常访问了。</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102193605035.png" alt="image-访问docker中的tomcat"></p>
<h3 id="7-提交镜像"><a href="#7-提交镜像" class="headerlink" title="7.提交镜像"></a>7.提交镜像</h3><p>从仓库下载下来的镜像都是只读的，每当我们操作镜像，就会在原来镜像的上面加一层我们自己的操作，我们可以将它保存起来，下次直接使用我们操作过的镜像。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 查看镜像</span><br><span class="line">[root@ming /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED       STATUS       PORTS                    NAMES</span><br><span class="line">89b24a4b7084   tomcat    "/bin/bash"   4 hours ago   Up 4 hours   0.0.0.0:3366-&gt;8080/tcp   infallible_lewin</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. 将我们操作过的镜像commit成mytomcat</span><br><span class="line">[root@ming /]# docker commit -m 'tomcat add webapps' -a 'xiaoming' 89b24a4b7084 mytomcat</span><br><span class="line">sha256:42d7b6dea11ce283033c6015765bff176ffbdad71105c02048e4e7352a5239f4</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 3. 查看镜像</span><br><span class="line">[root@ming /]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">mytomcat     latest    42d7b6dea11c   10 seconds ago   654MB  # 我们自己生成的镜像</span><br><span class="line">tomcat       latest    feba8d001e3f   2 weeks ago      649MB</span><br><span class="line">nginx        latest    ae2feff98a0c   2 weeks ago      133MB</span><br><span class="line">centos       latest    300e315adb2f   3 weeks ago      209MB</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 将镜像89b24a4b7084提交，生成我们自己的镜像mytomcat</span><br><span class="line">docker commit -m 'tomcat add webapps' -a 'xiaoming' 89b24a4b7084 mytomcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 参数解释</span><br><span class="line">-m  # 提交的信息,类似于git commit</span><br><span class="line">-a  # 作者</span><br></pre></td></tr></table></figure>

<h3 id="8-容器数据卷"><a href="#8-容器数据卷" class="headerlink" title="8.容器数据卷"></a>8.容器数据卷</h3><p>我们在容器内操作，数据保存在容器内，这是一件很<code>危险</code>的事情，假如不小心删除了容器，容器内的数据就全部丢失了。</p>
<p>有没有一种技术可以将容器内的数据同步到宿主机器上，将容器内的目录和宿主机的目录进行绑定，无论修改容器内的目录，还是修改宿主机的目录，都能自动同步数据，完成数据的持久化呢？ 这就是数据卷的技术。</p>
<p>使用以下命令完成数据卷的挂载：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v 宿主机的目录:容器内的目录</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 进入容器，进行目录挂载</span><br><span class="line">docker run -p 3355:8080 -v /home/test/:/home -it mytomcat /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. 查看镜像状态，查看挂载信息</span><br><span class="line">docker inspect 7feb5a932a8b</span><br><span class="line">"Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "bind",</span><br><span class="line">                "Source": "/home/test",</span><br><span class="line">                "Destination": "/home",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": "rprivate"</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 3. 进入到容器内,/home目录下创建文件test.java</span><br><span class="line">root@7feb5a932a8b:/home# ls</span><br><span class="line">test.java</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 4. 查看宿主机器/home/test目录下是否同步了test.java文件</span><br><span class="line">[root@ming test]# pwd</span><br><span class="line">/home/test</span><br><span class="line">[root@ming test]# ls</span><br><span class="line">test.java</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 5.在宿主机上修改test.java文件，修改其内容</span><br><span class="line">[root@ming test]# vim test.java </span><br><span class="line">[root@ming test]# cat test.java </span><br><span class="line">hello,world</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 6.查看容器中/home目录下的test.java文件</span><br><span class="line">root@7feb5a932a8b:/home# cat test.java </span><br><span class="line">hello,world</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 结论：使用数据卷技术，可以将容器内的目录和宿主机器上的目录进行同步，从而达到数据持久化的目的。</span><br></pre></td></tr></table></figure>

<h4 id="8-1-部署mysql"><a href="#8-1-部署mysql" class="headerlink" title="8.1 部署mysql"></a>8.1 部署mysql</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 直接使用docker run 下载mysql，如果本地不存在mysql的镜像，会从远程仓库中拉取</span><br><span class="line">docker run -p 3307:3306 -v /home/mysql/data:/var/lib/mysql -v /home/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456 --name mysql5.7 mysql:5.7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 参数解释</span><br><span class="line">-e  # 设置环境</span><br><span class="line">MYSQL_ROOT_PASSWORD # mysql root用户的密码</span><br><span class="line">--name  # 容器的名称</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2.使用navicat连接数据库，并创建数据库test</span><br><span class="line">host:47.96.224.198:3307 </span><br><span class="line">username:root</span><br><span class="line">password:123456</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 3. 查看宿主机上/home/mysql/data目录下有没有test数据库</span><br><span class="line">[root@ming data]# pwd</span><br><span class="line">/home/mysql/data</span><br><span class="line">[root@ming data]# ll |grep test</span><br><span class="line">drwxr-x--- 2 systemd-bus-proxy input     4096 Jan  2 20:14 test  # test数据库,说明容器内的目录和宿主机的目录已经同步</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 4. 删除容器</span><br><span class="line">docker rm -f a312a3e56f40 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 5.数据持久化了，即使删除容器，数据也不会丢失</span><br><span class="line">[root@ming data]# ll | grep test</span><br><span class="line">drwxr-x--- 2 systemd-bus-proxy input     4096 Jan  2 20:14 test</span><br></pre></td></tr></table></figure>

<h4 id="8-2-具名挂载和匿名挂载"><a href="#8-2-具名挂载和匿名挂载" class="headerlink" title="8.2 具名挂载和匿名挂载"></a>8.2 具名挂载和匿名挂载</h4><p>之前使用的<code>docker run -v 宿主机的目录:容器内的目录</code>是指定目录的挂载方式。</p>
<p>除此之外，还有具名挂载和匿名挂载。</p>
<blockquote>
<p>具名挂载</p>
</blockquote>
<p>具名挂载通过<code>docker run -v 卷名：容器内的目录</code>进行挂载。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 具名挂载的方式启动nginx</span><br><span class="line">docker run -d -p 3344:80 -v juming_nginx:/etc/nginx nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. 查看数据卷</span><br><span class="line">[root@ming /]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     juming_nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 3. 查看juming_nginx的详细信息</span><br><span class="line">[root@ming /]# docker volume inspect juming_nginx</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "CreatedAt": "2021-01-02T20:37:12+08:00",</span><br><span class="line">        "Driver": "local",</span><br><span class="line">        "Labels": null,</span><br><span class="line">        "Mountpoint": "/var/lib/docker/volumes/juming_nginx/_data",  # 挂载的路径</span><br><span class="line">        "Name": "juming_nginx",</span><br><span class="line">        "Options": null,</span><br><span class="line">        "Scope": "local"</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 4. 到挂载的路径下查看，nginx的配置文件目录已经挂载到了/var/lib/docker/volumes/juming_nginx/_data目录下</span><br><span class="line">[root@ming _data]# pwd</span><br><span class="line">/var/lib/docker/volumes/juming_nginx/_data</span><br><span class="line">[root@ming _data]# ls</span><br><span class="line">conf.d          koi-utf  mime.types  nginx.conf   uwsgi_params</span><br><span class="line">fastcgi_params  koi-win  modules     scgi_params  win-utf</span><br></pre></td></tr></table></figure>

<blockquote>
<p>匿名挂载</p>
</blockquote>
<p>匿名挂载通过<code>docker run -v 容器内路径</code>进行挂载。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 匿名挂载的方式启动nginx</span><br><span class="line">docker run -d -p 3344:80 -v /etc/nginx.conf nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. 查看数据卷,是一串字符串</span><br><span class="line">[root@ming _data]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     ffb564010a743ee8d607d1fd35bdf54fbef705881cf9c2625c431e83f626c532</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 3. 查看挂载的详细信息</span><br><span class="line">[root@ming _data]# docker volume inspect ffb564010a743ee8d607d1fd35bdf54fbef705881cf9c2625c431e83f626c532</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "CreatedAt": "2021-01-02T20:42:50+08:00",</span><br><span class="line">        "Driver": "local",</span><br><span class="line">        "Labels": null,</span><br><span class="line">        "Mountpoint": "/var/lib/docker/volumes/ffb564010a743ee8d607d1fd35bdf54fbef705881cf9c2625c431e83f626c532/_data",  # 挂载的目录</span><br><span class="line">        "Name": "ffb564010a743ee8d607d1fd35bdf54fbef705881cf9c2625c431e83f626c532",</span><br><span class="line">        "Options": null,</span><br><span class="line">        "Scope": "local"</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 4.到挂载的目录查看，发现目录是空的</span><br><span class="line">[root@ming _data]# pwd</span><br><span class="line">/var/lib/docker/volumes/2909b1711dfe40c72036dc8d950d2da653a6b88563acbb0b1e49932469e1247d/_data</span><br><span class="line">[root@ming _data]# ls</span><br></pre></td></tr></table></figure>

<p>我们发现，如果不是以指定目录的方式进行挂载，挂载的目录默认是在<code>/var/lib/docker/volumes/卷名/_data/</code>目录下。</p>
<h4 id="8-3-权限"><a href="#8-3-权限" class="headerlink" title="8.3 权限"></a>8.3 权限</h4><p>相对于容器内而言，默认情况下，文件是可读可写的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 启动nginx容器并进入容器</span><br><span class="line">docker run -p 3344:80 -v juming_nginx:/etc/nginx.conf -it nginx /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. 到/etc/目录下，查看nginx.conf的权限</span><br><span class="line">drwxr-xr-x 3 root root    4096 Jan  2 12:37 nginx.conf  # 可读可写的权限</span><br></pre></td></tr></table></figure>

<p>我们可以在启动容器的时候，指定容器内的文件权限：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. ro = read only ,在容器内只读，不能修改</span><br><span class="line">docker run -p 3344:80 -v juming_nginx:/etc/nginx.conf:ro -it nginx /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. rw = read write,在容器内可读，可写</span><br><span class="line">docker run -p 3344:80 -v juming_nginx:/etc/nginx.conf:ro -it nginx /bin/bash</span><br></pre></td></tr></table></figure>



<h4 id="8-4-多个容器挂载同一个目录"><a href="#8-4-多个容器挂载同一个目录" class="headerlink" title="8.4 多个容器挂载同一个目录"></a>8.4 多个容器挂载同一个目录</h4><p>使用–volume-for指定一个容器，同步这个容器的数据。就相当于，继承一个容器，自动同步它的数据。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 启动容器centos1,挂载容器内的目录/home/centos1</span><br><span class="line">docker run -it --name centos1 -v centos1:/home/centos1/ centos /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. 在centos1容器的/home/centos1目录下创建centos1.txt文件</span><br><span class="line">[root@69a8809a9e6f centos1]# pwd</span><br><span class="line">/home/centos1</span><br><span class="line">[root@69a8809a9e6f centos1]# ls</span><br><span class="line">centos1.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 3. 查看宿主机上centos1的挂载目录</span><br><span class="line">[root@ming _data]# pwd</span><br><span class="line">/var/lib/docker/volumes/centos1/_data</span><br><span class="line">[root@ming _data]# ls</span><br><span class="line">centos1.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 4. 启动容器centos2，centos2继承自centos1</span><br><span class="line">docker run -it --name centos2 --volumes-from centos1 centos /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 5. 进入到centos2的/home/centos1目录下</span><br><span class="line">[root@a5afec9346bd centos1]# pwd</span><br><span class="line">/home/centos1</span><br><span class="line">[root@a5afec9346bd centos1]# ls</span><br><span class="line">centos1.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 在centos2的目录下，可以看到centos1的目录</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 6. centos2容器中,在centos1目录中创建centos2.txt</span><br><span class="line">[root@a5afec9346bd centos2]# pwd</span><br><span class="line">/home/centos1</span><br><span class="line">[root@a5afec9346bd centos2]# ls</span><br><span class="line">centos1.txt centos2.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 7. 进入到centos1容器中，查看/home/centos1目录下是否多了centos2.txt</span><br><span class="line">[root@06e27ea51ee0 centos1]# ls  # centos1的目录下,存在centos2.txt，说明centos2创建的文件自动同步到centos1</span><br><span class="line">centos1.txt centos2.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 8. 查看centos2的挂载目录</span><br><span class="line">docker inspect centos2</span><br><span class="line">"Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "centos1",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/centos1/_data",</span><br><span class="line">                "Destination": "/home/centos1",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 9. 查看centos1的挂载目录</span><br><span class="line">docker inspect centos1</span><br><span class="line">"Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "centos1",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/centos1/_data",</span><br><span class="line">                "Destination": "/home/centos1",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "z",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 结论：centos1和centos2挂载的是同一个目录，连name都是相同的centos1。</span><br><span class="line"><span class="meta">#</span> 这意味着，我们查看centos2的详细数据卷信息，也是使用docker volume inspect centos1</span><br></pre></td></tr></table></figure>

<p>接下来，我们创建一个新的容器centos3，让它–volumes-from centos2,它能不能自动同步centos2创建的目录centos2呢？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 启动centos3容器</span><br><span class="line">docker run -it --name centos3 --volumes-from centos2 centos /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. 查看/home目录下是否存在centos2目录</span><br><span class="line">[root@96b772d61de0 home]# ls  # 说明centos3不能同步centos2创建的目录</span><br><span class="line">centos1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 3. 查看centos3挂载的目录信息</span><br><span class="line">docker inspect centos3</span><br><span class="line">"Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "centos1",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/centos1/_data",</span><br><span class="line">                "Destination": "/home/centos1",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> centos3虽然继承自centos2，但是centos2是继承自centos1，挂载的只是centos1的目录，所以centos3不能同步centos2创建的目录。</span><br></pre></td></tr></table></figure>

<h3 id="9-Dockfile"><a href="#9-Dockfile" class="headerlink" title="9.Dockfile"></a>9.Dockfile</h3><p>Dockfile是面向开发的，我们以后要发布项目，就需要编写dockfile文件。</p>
<h4 id="9-1-制作一个Dockefile"><a href="#9-1-制作一个Dockefile" class="headerlink" title="9.1 制作一个Dockefile"></a>9.1 制作一个Dockefile</h4><p>dockerfile就是一个脚本文件，里面的脚本用来创建镜像。</p>
<p>新建一个目录/home/docker_volume_test，创建dockerfile1的脚本文件。</p>
<p>需要注意的几点：</p>
<ul>
<li>每个保留关键字（指令）都必须是大写字母</li>
<li>执行从上到下顺序执行</li>
<li>每一个指令都会创建提交一个新的镜像层，并提交</li>
<li>必须使用双引号，单引号不行</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 匿名挂载</span><br><span class="line">VOLUME ["volume1","volume2"]</span><br><span class="line"></span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure>

<p>写好脚本文件后，使用<code>docker build</code>命令生成镜像。</p>
<p>需要注意的有2点：</p>
<ul>
<li>-t 生成的镜像名称不能带/</li>
<li>最后一个参数指定生成路径，.代表当前目录</li>
<li>如果文件命名为Dockerfile，在docker build的时候可以不指定-f参数</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 利用当前目录下的dockerfile文件在当前目录下生成xiaoming/centos的镜像</span><br><span class="line">[root@ming docker_volume_test]# docker build -f dockerfile1 -t xiaoming/centos .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt;</span> 300e315adb2f</span><br><span class="line">Step 2/4 : VOLUME ["volume1","volume2"]</span><br><span class="line"><span class="meta"> ---&gt;</span> Running in 7d9097ed198e</span><br><span class="line">Removing intermediate container 7d9097ed198e</span><br><span class="line"><span class="meta"> ---&gt;</span> 8f3d72c8bccc</span><br><span class="line">Step 3/4 : CMD echo '------end------'</span><br><span class="line"><span class="meta"> ---&gt;</span> Running in 27f56b2fe602</span><br><span class="line">Removing intermediate container 27f56b2fe602</span><br><span class="line"><span class="meta"> ---&gt;</span> bdcf8bb3ee27</span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"><span class="meta"> ---&gt;</span> Running in e9c64f298af8</span><br><span class="line">Removing intermediate container e9c64f298af8</span><br><span class="line"><span class="meta"> ---&gt;</span> 7fc575cbe035</span><br><span class="line">Successfully built 7fc575cbe035</span><br><span class="line">Successfully tagged xiaoming/centos:latest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 参数解释</span><br><span class="line">-f # 指定的dockfile文件</span><br><span class="line">-t # target,生成的目录镜像</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. 查看镜像</span><br><span class="line">[root@ming docker_volume_test]# docker images</span><br><span class="line">REPOSITORY        TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">xiaoming/centos   latest    7fc575cbe035   21 seconds ago   209MB  # 利用dockerfile生成的镜像文件</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 3. 启动容器</span><br><span class="line">[root@ming docker_volume_test]# docker run -it xiaoming/centos /bin/bash</span><br><span class="line">[root@40476da59260 /]# ls -l</span><br><span class="line">drwxr-xr-x  2 root root 4096 Jan  3 07:14 volume1 # 生成镜像的时候自动挂载的volume1目录</span><br><span class="line">drwxr-xr-x  2 root root 4096 Jan  3 07:14 volume2 # 生成镜像的时候自动挂载的volume2目录</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 4. 在容器内的volume1目录中创建文件volume1.txt</span><br><span class="line">[root@40476da59260 volume1]# pwd</span><br><span class="line">/volume1</span><br><span class="line">[root@40476da59260 volume1]# ls</span><br><span class="line">volume1.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 5. 查看挂载信息</span><br><span class="line">docker inspect 40476da59260  # 容器id</span><br><span class="line">"Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "188f9cd826889b4497db0df774a3c493666b808bce0cffbadc90ae20901fda49",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/188f9cd826889b4497db0df774a3c493666b808bce0cffbadc90ae20901fda49/_data",</span><br><span class="line">                "Destination": "volume1",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "9ecc05996ab6035f6fee907b130473f8ad9eba1244635a98bbf3e5dbde8747a8",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/9ecc05996ab6035f6fee907b130473f8ad9eba1244635a98bbf3e5dbde8747a8/_data",</span><br><span class="line">                "Destination": "volume2",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 6. 到挂载目录下查看是否同步了容器的文件</span><br><span class="line">[root@ming _data]# pwd</span><br><span class="line">/var/lib/docker/volumes/188f9cd826889b4497db0df774a3c493666b808bce0cffbadc90ae20901fda49/_data</span><br><span class="line">[root@ming _data]# ls</span><br><span class="line">volume1.txt  # 容器内创建的文件已经同步，说明挂载成功。</span><br></pre></td></tr></table></figure>

<h4 id="9-2-Dockfile指令"><a href="#9-2-Dockfile指令" class="headerlink" title="9.2 Dockfile指令"></a>9.2 Dockfile指令</h4><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>FROM</td>
<td>指定基础镜像，一切从这里开始构建</td>
</tr>
<tr>
<td>MAINTAINER</td>
<td>指定维护者信息（姓名+邮箱）</td>
</tr>
<tr>
<td>RUN</td>
<td>镜像构建的时候需要运行的命令</td>
</tr>
<tr>
<td>ADD</td>
<td>添加内容，会自动解压</td>
</tr>
<tr>
<td>WORKDIR</td>
<td>镜像的工作目录</td>
</tr>
<tr>
<td>VOLUME</td>
<td>设置卷，挂载主机目录</td>
</tr>
<tr>
<td>EXPOSE</td>
<td>暴露端口配置</td>
</tr>
<tr>
<td>CMD</td>
<td>指定容器启动的时候运行的命令，只有最后一个会生效</td>
</tr>
<tr>
<td>ENTRYPOINT</td>
<td>指定这个容器启动的时候运行的命令，可以追加命令</td>
</tr>
<tr>
<td>ONBUILD</td>
<td>当构建一个被继承Dockfile就会触发指令</td>
</tr>
<tr>
<td>COPY</td>
<td>类似ADD,将文件拷贝到镜像中</td>
</tr>
<tr>
<td>ENV</td>
<td>构建的时候设置环境变量</td>
</tr>
</tbody></table>
<h4 id="9-3-CMD与ENTRYPOINT的区别"><a href="#9-3-CMD与ENTRYPOINT的区别" class="headerlink" title="9.3 CMD与ENTRYPOINT的区别"></a>9.3 CMD与ENTRYPOINT的区别</h4><p>我们编写一个Dockerfile文件，创建添加了vim的centos：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 基于centos镜像构建</span><br><span class="line">FROM centos</span><br><span class="line"><span class="meta">#</span> 维护者</span><br><span class="line">MAINTAINER "ming&lt;11498895@qq.com&gt;"</span><br><span class="line"><span class="meta">#</span> 构建镜像，也就是执行docker build的时候，下载vim命令</span><br><span class="line">RUN yum -y install vim</span><br><span class="line"><span class="meta">#</span> 设置工作目录，容器启动的时候就在这个工作目录下</span><br><span class="line">ENV MAINDIR /home</span><br><span class="line">WORKDIR $MAINDIR</span><br><span class="line"><span class="meta">#</span> 启动容器时，执行的命令</span><br><span class="line">CMD ["ls","-l"]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 执行docker build 生成镜像</span><br><span class="line">docker build -f centos_dockfile -t centos:0.1 .</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 这里我们指定了生成镜像的版本号，在启动的时候，也需要指定镜像的版本号才能启动</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 启动容器，注意这里不指定使用/bin/bash启动，才会执行dockerfile中的cmd命令</span><br><span class="line">[root@ming docker_volume_test]# docker run centos:0.1</span><br><span class="line">total 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 容器启动的时候执行了ls -l命令</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. 做个测试，在启动容器的时候使其执行ls -l /命令</span><br><span class="line">[root@ming docker_volume_test]# docker run centos:0.1 /</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:370: starting container process caused: exec: "/": permission denied: unknown.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 这时候，产生了一个错误，这是由于docker run时指定的/命令替换了dockfile中CMD指定指定的ls -l命令，而/命令不是一个正确的命令，就报错了</span><br></pre></td></tr></table></figure>

<p>接下来，我们在dockerfile文件中使用ENTRYPOINT指令替换CMD指令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER "ming&lt;11498895@qq.com&gt;"</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"></span><br><span class="line">ENV MAINDIR /home</span><br><span class="line">WORKDIR $MAINDIR</span><br><span class="line"></span><br><span class="line">ENTRYPOINT ["ls","-l"]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 我们直接启动容器，执行的是ls -l 命令</span><br><span class="line">[root@ming docker_volume_test]# docker run centos:0.1</span><br><span class="line">total 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. 我们在启动容器的时候追加命令，使其执行ls -l /命令</span><br><span class="line">[root@ming docker_volume_test]# docker run centos:0.1 /</span><br><span class="line">total 48</span><br><span class="line">lrwxrwxrwx  1 root root    7 Nov  3 15:22 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x  5 root root  340 Jan  3 09:57 dev</span><br><span class="line">drwxr-xr-x  1 root root 4096 Jan  3 09:57 etc</span><br><span class="line">drwxr-xr-x  2 root root 4096 Nov  3 15:22 home</span><br><span class="line">lrwxrwxrwx  1 root root    7 Nov  3 15:22 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx  1 root root    9 Nov  3 15:22 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------  2 root root 4096 Dec  4 17:37 lost+found</span><br><span class="line">drwxr-xr-x  2 root root 4096 Nov  3 15:22 media</span><br><span class="line">drwxr-xr-x  2 root root 4096 Nov  3 15:22 mnt</span><br><span class="line">drwxr-xr-x  2 root root 4096 Nov  3 15:22 opt</span><br><span class="line">dr-xr-xr-x 90 root root    0 Jan  3 09:57 proc</span><br><span class="line">dr-xr-x---  1 root root 4096 Jan  3 09:55 root</span><br><span class="line">drwxr-xr-x 11 root root 4096 Dec  4 17:37 run</span><br><span class="line">lrwxrwxrwx  1 root root    8 Nov  3 15:22 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x  2 root root 4096 Nov  3 15:22 srv</span><br><span class="line">dr-xr-xr-x 13 root root    0 Jan  3 09:57 sys</span><br><span class="line">drwxrwxrwt  7 root root 4096 Dec  4 17:37 tmp</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  4 17:37 usr</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  4 17:37 var</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 结论：如果使用ENTRYPOINT,我们在docker run时指定的命令是会追加到原来命令的后面的</span><br></pre></td></tr></table></figure>

<h4 id="9-4-查看构建过程"><a href="#9-4-查看构建过程" class="headerlink" title="9.4 查看构建过程"></a>9.4 查看构建过程</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 使用docker history 镜像id  可以查看一个镜像构建的过程</span><br><span class="line">[root@ming ~]# docker history 7e97f5b8161a</span><br><span class="line">IMAGE          CREATED         CREATED BY                                      SIZE      COMMENT</span><br><span class="line">7e97f5b8161a   3 minutes ago   /bin/sh -c #(nop)  CMD ["/bin/sh" "-c" "sh /…   0B        </span><br><span class="line">4744060107e4   3 minutes ago   /bin/sh -c #(nop)  EXPOSE 8080                  0B        </span><br><span class="line">cd04af7c483b   3 minutes ago   /bin/sh -c #(nop) WORKDIR /usr/local/tomcat     0B        </span><br><span class="line">c7b335498d11   3 minutes ago   /bin/sh -c #(nop)  ENV MAINPATH=/usr/local/t…   0B        </span><br><span class="line">d07929bdbbaa   3 minutes ago   /bin/sh -c #(nop)  ENV PATH=/usr/local/sbin:…   0B        </span><br><span class="line">f3fc451eee02   3 minutes ago   /bin/sh -c #(nop)  ENV CATALINA_BASH=/usr/lo…   0B        </span><br><span class="line">3498f6fce614   3 minutes ago   /bin/sh -c #(nop)  ENV CATALINA_HOME=/usr/lo…   0B        </span><br><span class="line">978f9d791d9c   3 minutes ago   /bin/sh -c #(nop)  ENV CLASSPATH=.:/usr/loca…   0B        </span><br><span class="line">92e9bc253a9e   3 minutes ago   /bin/sh -c #(nop)  ENV JAVA_HOME=/usr/local/…   0B        </span><br><span class="line">8773f4df5b08   3 minutes ago   /bin/sh -c cd /usr/local/java &amp;&amp; yum -y inst…   349MB     </span><br><span class="line">90e3f7678077   4 minutes ago   /bin/sh -c #(nop) ADD file:a1bfef71355927262…   113MB     </span><br><span class="line">f4149d27d5d7   4 minutes ago   /bin/sh -c #(nop) ADD file:f10b183415fb392e3…   14.6MB    </span><br><span class="line">256d743023b7   4 minutes ago   /bin/sh -c yum -y install rpm                   1.83MB    </span><br><span class="line">1bbdc376780a   4 minutes ago   /bin/sh -c yum -y install vim                   58MB      </span><br><span class="line">c1b496dc6b45   5 minutes ago   /bin/sh -c #(nop)  MAINTAINER xiaoming&lt;11498…   0B        </span><br><span class="line">300e315adb2f   3 weeks ago     /bin/sh -c #(nop)  CMD ["/bin/bash"]            0B        </span><br><span class="line">&lt;missing&gt;      3 weeks ago     /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B        </span><br><span class="line">&lt;missing&gt;      3 weeks ago     /bin/sh -c #(nop) ADD file:bd7a2aed6ede423b7…   209MB</span><br></pre></td></tr></table></figure>

<h4 id="9-5-制作tomcat的Dockfile"><a href="#9-5-制作tomcat的Dockfile" class="headerlink" title="9.5 制作tomcat的Dockfile"></a>9.5 制作tomcat的Dockfile</h4><blockquote>
<p>准备tomcat，JDK的压缩包,编写Dockerfile</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 基于centos</span><br><span class="line">FROM centos</span><br><span class="line"><span class="meta">#</span> 作者信息</span><br><span class="line">MAINTAINER xiaoming&lt;1149895826@qq.com&gt;</span><br><span class="line"><span class="meta">#</span> 下载vim</span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install rpm</span><br><span class="line"><span class="meta">#</span> 将当前目录下的压缩包发送到服务器，ADD指令会自动解压</span><br><span class="line">ADD apache-tomcat-8.5.61.tar.gz /usr/local/tomcat/</span><br><span class="line"><span class="meta">#</span> 将当前目录下的JDK rpm包发送到服务器</span><br><span class="line">ADD jdk-8u271-linux-x64.rpm /usr/local/java/</span><br><span class="line"><span class="meta">#</span> 下载rpm包，安装JDK</span><br><span class="line">RUN cd /usr/local/java &amp;&amp; yum -y install /usr/local/java/jdk-8u271-linux-x64.rpm &amp;&amp; yum install which -y</span><br><span class="line"><span class="meta">#</span> 设置环境变量,这里非常重要，稍微有一点错误，容器就启动不起来</span><br><span class="line">ENV JAVA_HOME /usr/java/jdk1.8.0_271-amd64</span><br><span class="line">ENV CLASSPATH .:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/tomcat/apache-tomcat-8.5.61</span><br><span class="line">ENV CATALINA_BASH /usr/local/tomcat/apache-tomcat-8.5.61</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"><span class="meta">#</span> 设置容器启动时的工作目录</span><br><span class="line">ENV MAINPATH /usr/local/tomcat</span><br><span class="line">WORKDIR $MAINPATH</span><br><span class="line"><span class="meta">#</span> 暴露容器的端口</span><br><span class="line">EXPOSE 8080</span><br><span class="line"><span class="meta">#</span> 容器启动时执行的命令：启动tomcat，并打印启动日志</span><br><span class="line">CMD sh /usr/local/tomcat/apache-tomcat-8.5.61/bin/startup.sh &amp;&amp; tail -f /usr/local/tomcat/apache-tomcat-8.5.61/logs/catalina.out</span><br></pre></td></tr></table></figure>

<blockquote>
<p>docker build 生成镜像文件</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 由于文件命名是Dockerfile,无需指定-f参数</span><br><span class="line">docker build -t diy_tomcat .</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. 后台启动容器,将tomcat的webapps和日志目录挂载到宿主机,启动后自动打印启动日志</span><br><span class="line">[root@ming diy_tomcat]# docker run -p 3344:8080 -v /home/diy_tomcat/webapps/:/usr/local/tomcat/apache-tomcat-8.5.61/webapps/ -v /home/diy_tomcat/logs/:/usr/local/tomcat/apache-tomcat-8.5.61/logs/ diy_tomcat </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 3. 查看容器,容器正在运行</span><br><span class="line">[root@ming diy_tomcat]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE        COMMAND                  CREATED              STATUS              PORTS                    NAMES</span><br><span class="line">3134796152c3   diy_tomcat   "/bin/sh -c 'sh /usr…"   About a minute ago   Up About a minute   0.0.0.0:3344-&gt;8080/tcp   heuristic_kare</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 4.外网访问http://47.96.224.198:3344/,访问正常</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 5. 查看宿主机挂载的目录是否挂载成功</span><br><span class="line">[root@ming webapps]# pwd</span><br><span class="line">/home/diy_tomcat/webapps</span><br><span class="line">[root@ming webapps]# ls</span><br><span class="line">balance  dev  docs  examples  host-manager  manager  ROOT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 以后，我们只需要将项目部署在宿主机的webapps目录下就可以啦</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo "1"&gt;/proc/sys/vm/drop_caches</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
        
      
        <div id="reward-container">
  <div>一毛也是爱~</div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
        
      
      <div style="display: inline-block">
        <img src="/images/wechatpay.jpg" alt="JinMing 微信支付">
        <p>微信支付</p>
      </div>

  </div>
</div>

      

      <footer class="post-footer">

        
  <div class="post-widgets">
    <div class="social-share">
      
      
        <div id="needsharebutton-postbottom">
          <span class="btn">
            <i class="fa fa-share-alt" aria-hidden="true"></i>
          </span>
        </div>
      
    </div>
  
  </div>

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2020/12/30/Spring Cloud/curl/" rel="next" title="">
                  <i class="fa fa-chevron-left"></i> 
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/1.jpg"
      alt="JinMing">
  <p class="site-author-name" itemprop="name">JinMing</p>
  <div class="site-description motion-element" itemprop="description">且行且珍惜</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">76</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span>
        
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">41</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:woshizhangjinming@vip.qq.com" title="E-Mail &rarr; mailto:woshizhangjinming@vip.qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://weibo.com/6196561949" title="Weibo &rarr; https://weibo.com/6196561949" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
    
  </div>



        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Docker简介"><span class="nav-number">1.</span> <span class="nav-text">1. Docker简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-基本概念"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 基本概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-安装Docker"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 安装Docker</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-阿里云镜像加速器"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 阿里云镜像加速器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-docerk-run-流程"><span class="nav-number">1.4.</span> <span class="nav-text">1.4 docerk run 流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-底层原理"><span class="nav-number">1.5.</span> <span class="nav-text">1.5 底层原理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-镜像的基本命令"><span class="nav-number">2.</span> <span class="nav-text">2.镜像的基本命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-查看镜像"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 查看镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-搜索镜像"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 搜索镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-下载镜像"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 下载镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-删除镜像"><span class="nav-number">2.4.</span> <span class="nav-text">2.4 删除镜像</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-容器的基本命令"><span class="nav-number">3.</span> <span class="nav-text">3.容器的基本命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-创建容器并启动"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 创建容器并启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-查看容器"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 查看容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-退出容器"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 退出容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-删除容器"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 删除容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-启动和停止容器"><span class="nav-number">3.5.</span> <span class="nav-text">3.5 启动和停止容器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-常用其他命令"><span class="nav-number">4.</span> <span class="nav-text">4.常用其他命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-后台启动容器"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 后台启动容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-查看日志"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 查看日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-查看容器中进程的信息"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 查看容器中进程的信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-查看镜像的元数据"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 查看镜像的元数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-进入当前正在运行的容器"><span class="nav-number">4.5.</span> <span class="nav-text">4.5 进入当前正在运行的容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-6-从容器内拷贝文件到主机上"><span class="nav-number">4.6.</span> <span class="nav-text">4.6 从容器内拷贝文件到主机上</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-命令小结"><span class="nav-number">5.</span> <span class="nav-text">5.命令小结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-小实战"><span class="nav-number">6.</span> <span class="nav-text">6. 小实战</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-部署nginx"><span class="nav-number">6.1.</span> <span class="nav-text">6.1 部署nginx</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-部署tomcat"><span class="nav-number">6.2.</span> <span class="nav-text">6.2 部署tomcat</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-提交镜像"><span class="nav-number">7.</span> <span class="nav-text">7.提交镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-容器数据卷"><span class="nav-number">8.</span> <span class="nav-text">8.容器数据卷</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-1-部署mysql"><span class="nav-number">8.1.</span> <span class="nav-text">8.1 部署mysql</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-具名挂载和匿名挂载"><span class="nav-number">8.2.</span> <span class="nav-text">8.2 具名挂载和匿名挂载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-权限"><span class="nav-number">8.3.</span> <span class="nav-text">8.3 权限</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-多个容器挂载同一个目录"><span class="nav-number">8.4.</span> <span class="nav-text">8.4 多个容器挂载同一个目录</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-Dockfile"><span class="nav-number">9.</span> <span class="nav-text">9.Dockfile</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#9-1-制作一个Dockefile"><span class="nav-number">9.1.</span> <span class="nav-text">9.1 制作一个Dockefile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-2-Dockfile指令"><span class="nav-number">9.2.</span> <span class="nav-text">9.2 Dockfile指令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-CMD与ENTRYPOINT的区别"><span class="nav-number">9.3.</span> <span class="nav-text">9.3 CMD与ENTRYPOINT的区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-4-查看构建过程"><span class="nav-number">9.4.</span> <span class="nav-text">9.4 查看构建过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-5-制作tomcat的Dockfile"><span class="nav-number">9.5.</span> <span class="nav-text">9.5 制作tomcat的Dockfile</span></a></li></ol></li></ol></div>
            

            
            
          </div>
        </div>
      <!--/noindex-->
      


    </div>
  </aside>
  
  

  <div id="sidebar-dimmer"></div>
 


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">  <a href="http://www.beian.miit.gov.cn" rel="noopener" target="_blank">粵ICP备19091267号 </a>&copy; 2019 – <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JinMing</span>
</div>


<div class="busuanzi-count">
  <script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item-icon">
      本站总访问量 
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv">4</span>
    </span>
    <span> 次 </span>
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item-icon">
      有 
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv">309</span>
    </span>
    <span> 人看我的博客啦 </span>
  <span class="post-meta-divider">|</span>
  <div class="powered-by"></div>
  <span class="post-count">博客全站共120.1k字</span>
</div>


<div>
<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("08/08/2019 14:00:00");
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>
</div>




  
  

        








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>

    
  
  <div id="needsharebutton-float">
    <span class="btn">
      <i class="fa fa-share-alt" aria-hidden="true"></i>
    </span>
  </div>
<script src="/lib/needsharebutton/needsharebutton.js"></script>
<script>
    pbOptions = {};
      pbOptions.iconStyle = "box";
    
      pbOptions.boxForm = "horizontal";
    
      pbOptions.position = "bottomCenter";
    
      pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
    
    new needShareButton('#needsharebutton-postbottom', pbOptions);
    flOptions = {};
      flOptions.iconStyle = "box";
    
      flOptions.boxForm = "horizontal";
    
      flOptions.position = "middleRight";
    
      flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
    
    new needShareButton('#needsharebutton-float', flOptions);
</script>


  </div>

  
    
    
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>
  <script src="/lib/reading_progress/reading_progress.js"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

<script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>


  <script src="/js/affix.js?v=7.3.0"></script>
  <script src="/js/schemes/pisces.js?v=7.3.0"></script>


<script src="/js/next-boot.js?v=7.3.0"></script>






  


  <script src="/lib/bookmark/bookmark.min.js?v=1.0"></script>
  <script>
  if (CONFIG.page.isPost) {
    bookmark.scrollToMark('auto', "#更多");
  } else {
    bookmark.loadBookmark();
  }
  </script>













  <script src="/js/local-search.js?v=7.3.0"></script>














  

  

  


  
  <script src="/js/scrollspy.js?v=7.3.0"></script>
<script src="/js/post-details.js?v=7.3.0"></script>


</body>
<script type="text/javascript" src="/js/clicklove.js"></script>
</html>
